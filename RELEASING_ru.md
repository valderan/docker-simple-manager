# Подготовка релиза Docker Simple Manager

Актуальная англоязычная версия чеклиста находится в `RELEASING.md`.

## Предварительные условия

- Установлен `uv` и настроено окружение разработки (`uv pip install -e ".[dev]"`).
- Docker Engine или Docker Desktop доступны для локальных smoke-тестов.
- На macOS установлены инструменты командной строки Xcode; при необходимости выполните codesign/notarization вручную (в текущем чеклисте не автоматизировано).

## Чеклист релиза

1. **Обновить версию проекта**
   - Изменить `version` в `pyproject.toml`.
   - При необходимости обновить версии/ссылки в документации или README.

2. **Документация**
   - Убедиться, что `README.md`, `README_en.md` актуальны.
   - Добавить новую запись в `CHANGELOG.md`.

3. **Проверки качества**
   ```bash
   make lint
   make typecheck
   make test
   ```

4. **Smoke-тест приложения**
   - Запустить `uv run docker-simple-manager`.
   - Проверить минимум одно локальное соединение, обновление вкладок, диалоги (соединения, проекты, настройки, логи).

5. **Сборка бинарников**
   ```bash
   make build-linux                    # результат dist/dsm-linux/dsm
   # На macOS:
   DSM_MAC_ARCH=universal2 make build-macos
   ```
   - Для конкретной архитектуры macOS используйте `DSM_MAC_ARCH=arm64` или `DSM_MAC_ARCH=x86_64`.
   - Для публикации `.deb` (Linux) выполните `make package-deb` — пакет появится в `dist/docker-simple-manager_<версия>_amd64.deb`.

6. **Проверка артефактов**
   - Запустить бинарники из `dist/dsm-linux/dsm` и `dist/dist-macos/dsm`, убедиться в отсутствии ошибок при старте.
   - Упаковать каталоги для публикации (например, `tar.gz` для Linux, `.zip` / `.dmg` для macOS).
   - При необходимости проверить установку `.deb` пакета.

7. **Очистка**
   ```bash
   make dist-clean
   ```

8. **Коммит и тег**
   - Зафиксировать изменения (`git commit -am "Release vx.y.z"`).
   - Создать аннотированный тег `git tag -a vx.y.z -m "Release vx.y.z"`.

9. **Публикация**
   - Отправить коммиты и теги на GitHub.
   - Создать GitHub Release, приложить бинарники и текст из `CHANGELOG.md`.

## Примечания

- PyInstaller на Linux может предупреждать об отсутствии системных библиотек (например, `libtiff.so.5`). Убедитесь, что в релизных заметках перечислены необходимые пакеты.
- Для полноценного релиза macOS (с подписью и нотацией) добавьте отдельный шаг codesign/notarize.
