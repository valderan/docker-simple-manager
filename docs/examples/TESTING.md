# Руководство по тестированию

## Запуск тестов

```bash
uv pip install -e ".[dev]"
uv run pytest
```

Для проверки покрытия:

```bash
uv run pytest --cov=src --cov-report=term-missing --cov-report=xml
```

CI выполняет те же команды на Ubuntu и macOS с Python 3.13 и требует минимум 80% покрытия.

## Организация тестов

- `tests/test_settings/` — валидаторы, группы, реестр, наблюдатели, миграции.
- `tests/test_main.py` — вспомогательные функции модуля `main`.
- Папки `tests/test_connections`, `tests/test_projects`, `tests/test_docker_api`, `tests/test_ui`, `tests/test_utils` подготовлены под будущие тестовые наборы.

Каждый модуль/класс в `src/` должен иметь соответствующие unit-тесты. Для взаимодействия с файловой системой используем `tmp_path`/`monkeypatch`.

## Написание новых тестов

1. Размещайте новые тесты в соответствующей подпапке (`tests/test_<subsystem>`).
2. Используйте `pytest` fixtures (`tmp_path`, `caplog`, `monkeypatch`) вместо прямой работы с реальными ресурсами.
3. Для сетевых операций внедряйте mock-объекты (например, patch docker/paramiko клиентов).
4. Проверяйте как успешные сценарии, так и ошибки (исключения, откаты миграций).

## Требования к покрытию

- Цель фазы 1 — 80%+ покрытия для директории `src/`.
- Критические компоненты (`settings/`, `main.py`) должны иметь тесты на основные пути и обработку ошибок.
- При добавлении функционала обновляйте тесты сразу в том же коммите.
