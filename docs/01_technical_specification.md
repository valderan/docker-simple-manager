# Техническое задание: Docker Simple Manager

## 1. Общая информация о проекте

**Название проекта:** Docker Simple Manager (DSM)  
**Версия:** 1.0.0  
**Язык разработки:** Python 3.13+  
**Фреймворк UI:** PySide6  
**Менеджер пакетов:** uv  
**Целевые ОС:** Linux, macOS  
**Тип приложения:** Кроссплатформенное десктопное приложение с графическим интерфейсом  
**Формат сборки:** PyInstaller (单файл исполняемый файл)

---

## 2. Описание проекта

Docker Simple Manager — это графическое приложение для управления Docker контейнерами, образами, томами и сборками. Приложение предоставляет удобный интерфейс для работы с локальными Docker инстансами, Docker Desktop и удаленными Docker хостами через SSH соединение.

### 2.1 Основные возможности

- ✅ Управление несколькими Docker соединениями одновременно
- ✅ Создание и управление проектами с командами/путями для быстрого запуска
- ✅ Просмотр и управление контейнерами, образами, томами и сборками
- ✅ Работа с SSH соединениями для удаленных хостов
- ✅ Просмотр логов контейнеров и проектов
- ✅ Система настроек с сохранением состояния
- ✅ Поддержка русского и английского языков
- ✅ Темная и светлая цветовые схемы
- ✅ Система горячих клавиш для быстрого доступа
- ✅ История запусков проектов
- ✅ Экспорт/импорт проектов и соединений
- ✅ Версионирование конфигураций
- ✅ Автообновление приложения

---

## 3. Требования к функциональности

### 3.1 Инициализация при запуске

При первом запуске программа должна:

1. **Проверить рабочую директорию** (`~/.dsmanager`)
   - Если не существует → предложить создание
   - Создать структуру: `projects/`, `logs/`, `config.json`, `connections.json`
   - Создать `logs/INSTALL.log` с подробным описанием

2. **Проверить наличие Docker**
   - Определить наличие `docker` и `docker-compose`
   - Если не найдены → вывести уведомление пользователю

3. **Инициализировать соединения**
   - Если `connections.json` пуст и Docker установлен → добавить локальное соединение
   - Если обнаружен Docker Desktop → добавить его соединение
   - Загрузить все существующие проекты из `projects/`

4. **Загрузить конфигурацию**
   - Прочитать `config.json`
   - Загрузить сохраненное состояние (размер окна, активные вкладки, язык, тема)
   - Применить сохраненные настройки

### 3.2 Менеджер соединений (Connection Manager)

**Функциональность:**
- Создание новых соединений к Docker с указанием:
  - Имя соединения (название)
  - Сокет Docker (по умолчанию `/var/run/docker.sock`)
  - SSH параметры для удаленного подключения
  - Комментарий/описание
  - Тестирование соединения перед сохранением

- Редактирование существующих соединений
- Удаление соединений
- Клонирование соединений (только удаленные)
- Проверка активности соединения
- Валидация: нельзя создать 2 соединения с одинаковым сокетом

**Интерфейс:**
- Табличное представление со столбцами: Имя | Тип | Статус | Действия
- Кнопки действий (icon buttons): Редактировать | Запустить | Удалить
- Кнопка "Добавить новое соединение"
- Отдельное окно для создания/редактирования

### 3.3 Менеджер проектов (Project Manager)

**Функциональность:**
- Создание проектов с:
  - Имя проекта (slug)
  - Описание
  - Команда запуска ИЛИ путь к Docker/docker-compose файлу
  - Выбор соединения для запуска
  - Теги
  - Приоритет
  - Статус
  - Дата создания (автоматически)
  - Версия
  - История запусков

- Редактирование проектов
- Удаление проектов
- Экспорт/импорт проектов (JSON/ZIP формат)
- Версионирование конфигураций
- Просмотр истории запусков

**Интерфейс:**
- Табличное представление проектов
- Кнопки действий: Редактировать | Запустить | Просмотр логов | Удалить
- Отдельное окно для создания/редактирования
- Возможность поиска и фильтрации

### 3.4 Работа с Docker контейнерами

**Таблица Containers:**
- Отображение всех контейнеров
- Группировка по проектам (если контейнер часть проекта)
- Столбцы: ID | Имя | Статус | Порты | Размер | Созданный
- Действия: Start | Pause | Restart | Delete | View Details | Cmd

**View Details:**
- View Logs - просмотр логов контейнера
- Inspect - просмотр деталей (JSON)

**Cmd:**
- Открытие интерактивного терминала в контейнере

### 3.5 Работа с Docker образами (Images)

**Таблица Images:**
- Столбцы: Имя | Тег | ID | Размер | Создан
- Действия: Run | View Container Usage | View Package and CVEs | Pull | Delete

### 3.6 Работа с Docker томами (Volumes)

**Таблица Volumes:**
- Столбцы: Имя | Драйвер | Точка монтирования | Размер
- Действия: Import | Clone | Delete | Stored Data | Export Logs

### 3.7 Работа с Docker сборками (Builds)

**Таблица Builds:**
- Отображение истории сборок
- Группировка по проектам (если сборка часть проекта)
- Столбцы: Имя | Статус | Дата | Время сборки
- Действия: Import | Build Details | Delete

### 3.8 Система логирования

**Функционал Logs:**
- Открывается во вкладке основного окна
- Чтение файлов логов из `~/.dsmanager/logs/`
- Поиск и фильтрация по ключевым словам
- Удаление отдельных строк или целых файлов
- Отображение логов в структурированном виде
- Автоматическое логирование на английском языке всех действий

**Логируемые события:**
- Создание/редактирование/удаление соединений
- Создание/редактирование/удаление проектов
- Запуск проектов и команд
- Ошибки подключения
- Системные события

### 3.9 Справка (Help)

**Функционал:**
- Отдельное окно со справочной информацией
- Разделы: Начало работы | Соединения | Проекты | Docker объекты | Настройки
- Возможность поиска информации
- Ссылки на документацию

### 3.10 Настройки (Settings)

**Вкладка "Основные":**
- Язык (Русский/English)
- Автозагрузка проектов (вкл/выкл)
- Автоподключение при старте (список соединений)
- Default соединение при запуске
- Сохранение размеров окна между запусками
- Размер окна по умолчанию (полный экран)

**Вкладка "Логирование":**
- Включить/отключить логирование
- Уровень логирования (Debug | Info | Warning | Error)
- Максимальный размер логового файла
- Количество архивируемых логов

**Вкладка "Цветовые схемы":**
- Выбор темы (Светлая | Темная | Системная)
- Предпросмотр цветов
- Редактирование цветов для светлой темы
- Редактирование цветов для темной темы

**Вкладка "Горячие клавиши":**
- Назначение клавиш для:
  - Открыть менеджер соединений
  - Открыть менеджер проектов
  - Открыть настройки
  - Открыть логи
  - Открыть справку
  - Переключение между вкладками
  - Запуск последнего проекта

### 3.11 Главное окно

**Структура:**
1. **Меню программы:**
   - Соединения → Открыть новое | Закрыть активное | Менеджер соединений
   - Проекты → Открыть менеджер проектов
   - Параметры → Настройки | Логи | Справка | О программе

2. **Узкий дашборд (можно отключить в настройках):**
   - Кол-во соединений
   - Кол-во проектов
   - Свободная память на хосте
   - Свободное место на дисках

3. **Основная рабочая область:**
   - Система вкладок для соединений Docker
   - Каждое соединение — отдельная вкладка
   - Боковое меню для переключения между: Containers | Images | Volumes | Builds
   - Каждая таблица с соответствующим функционалом

4. **Footer панель:**
   - Кнопка открытия терминала
   - Статус активного соединения
   - Информация о количестве объектов
   - Разворачивается вверх на 50% рабочей области

---

## 4. Архитектура данных

### 4.1 Структура рабочей директории

```
~/.dsmanager/
├── projects/                 # JSON файлы проектов
│   ├── project-slug-1.json
│   ├── project-slug-2.json
│   └── ...
├── logs/                     # Логовые файлы
│   ├── INSTALL.log
│   ├── app.log
│   ├── connections.log
│   ├── projects.log
│   └── ...
├── config.json              # Конфигурация приложения
└── connections.json         # Конфигурации соединений
```

### 4.2 Структура config.json

```json
{
  "version": "1.0.0",
  "app": {
    "language": "ru",
    "theme": "system",
    "window": {
      "width": 1920,
      "height": 1080,
      "x": 0,
      "y": 0,
      "maximized": true
    }
  },
  "settings": {
    "auto_load_projects": true,
    "auto_connect_on_startup": ["connection-id-1"],
    "default_connection": "connection-id-1",
    "refresh_rate_ms": 5000,
    "save_window_state": true
  },
  "logging": {
    "enabled": true,
    "level": "INFO",
    "max_file_size_mb": 10,
    "max_archived_files": 5
  },
  "hotkeys": {
    "open_connections_manager": "Ctrl+Alt+C",
    "open_projects_manager": "Ctrl+Alt+P",
    "open_settings": "Ctrl+Alt+S",
    "open_logs": "Ctrl+Alt+L",
    "open_help": "Ctrl+Alt+H",
    "next_tab": "Ctrl+Tab",
    "prev_tab": "Ctrl+Shift+Tab",
    "run_last_project": "Ctrl+Alt+R"
  },
  "open_tabs": [
    {
      "type": "connection",
      "connection_id": "connection-id-1",
      "view": "containers"
    }
  ]
}
```

### 4.3 Структура connections.json

```json
{
  "connections": [
    {
      "id": "unique-connection-id",
      "name": "Docker Local",
      "type": "local",
      "socket": "unix:///var/run/docker.sock",
      "ssh": null,
      "comment": "Local Docker instance",
      "created_at": "2024-11-30T10:00:00Z",
      "last_used": "2024-11-30T10:30:00Z",
      "is_active": true,
      "version": 1
    },
    {
      "id": "unique-connection-id-2",
      "name": "Docker Desktop",
      "type": "local",
      "socket": "unix:///home/user/.docker/desktop/docker.sock",
      "ssh": null,
      "comment": "Docker Desktop",
      "created_at": "2024-11-30T10:05:00Z",
      "last_used": null,
      "is_active": false,
      "version": 1
    },
    {
      "id": "unique-connection-id-3",
      "name": "Remote Server",
      "type": "remote",
      "socket": "unix:///var/run/docker.sock",
      "ssh": {
        "host": "192.168.1.100",
        "port": 22,
        "username": "user",
        "password": null,
        "key_path": "/home/user/.ssh/id_rsa",
        "use_ssh_key": true
      },
      "comment": "Remote Docker on production server",
      "created_at": "2024-11-30T10:10:00Z",
      "last_used": null,
      "is_active": false,
      "version": 1
    }
  ]
}
```

### 4.4 Структура Project JSON

```json
{
  "id": "project-slug-1",
  "name": "My Web App",
  "slug": "project-slug-1",
  "description": "Основное веб приложение",
  "type": "docker_command|dockerfile_path|compose_path|bash_script",
  "command_or_path": "docker run -it ubuntu:latest",
  "connection_id": "connection-id-1",
  "tags": ["web", "production"],
  "priority": 1,
  "status": "active",
  "version": 1,
  "created_at": "2024-11-30T10:00:00Z",
  "updated_at": "2024-11-30T10:30:00Z",
  "author": "user",
  "run_history": [
    {
      "run_id": "run-uuid-1",
      "timestamp": "2024-11-30T10:30:00Z",
      "status": "success|failed",
      "duration_ms": 5000,
      "log_file": "~/.dsmanager/logs/project-slug-1-run-1.log",
      "error_message": null
    }
  ]
}
```

---

## 5. Требования к интерфейсу (UI/UX)

### 5.1 Общие требования

- ✅ Переиспользуемые компоненты (кнопки, диалоги, таблицы)
- ✅ Единый стиль оформления
- ✅ Подсказки (tooltips) для всех кнопок
- ✅ Диалоги подтверждения для деструктивных операций
- ✅ Две цветовые схемы (светлая и темная) с возможностью кастомизации
- ✅ Поддержка системной темы по умолчанию
- ✅ Адаптивный дизайн

### 5.2 Проектирование на основе изображений

Приложение должно использовать стиль дизайна, представленный в прикрепленных изображениях:
- `builds.jpg` - стиль таблицы Builds
- `images.jpg` - стиль таблицы Images
- `volumes.jpg` - стиль таблицы Volumes
- `containers.jpg` - стиль таблицы Containers
- `footer.jpg` - стиль Footer панели

### 5.3 Доступность

- ✅ Поддержка клавиатурной навигации
- ✅ Правильная иерархия фокуса
- ✅ Достаточный контраст цветов (WCAG AA)
- ✅ ARIA labels и descriptions где необходимо

---

## 6. Требования к производительности

- Время загрузки приложения: < 3 сек
- Время подключения к Docker: < 2 сек
- Обновление информации: configurable (default 5 сек)
- Максимум логов в памяти: 10000 строк
- Максимум размер логового файла: 10 МБ (конфигурируется)

---

## 7. Требования к безопасности

- ✅ SSH ключи хранятся зашифрованными в конфиге
- ✅ Пароли SSH хранятся в защищенном виде (использовать keyring системы)
- ✅ Валидация всех входных данных
- ✅ Санитизация команд перед выполнением
- ✅ Логирование всех действий с соединениями

---

## 8. Требования к кроссплатформенности

**Linux:**
- Ubuntu 20.04+
- Debian 11+
- Fedora 36+
- CentOS 8+

**macOS:**
- macOS 11 Big Sur+
- macOS 12 Monterey+
- macOS 13 Ventura+
- macOS 14 Sonoma+

---

## 9. Технический стек

| Компонент | Технология |
|-----------|-----------|
| Язык | Python 3.13+ |
| UI Framework | PySide6 |
| Менеджер пакетов | uv |
| Docker API | docker-py |
| SSH | paramiko |
| Логирование | logging |
| Конфиг | JSON |
| Сборка | PyInstaller |
| Версионирование | Semantic Versioning |

---

## 10. План развития (Roadmap)

### v1.0.0 (MVP)
- ✅ Все основные функции из ТЗ

### v1.1.0
- Улучшения производительности
- Дополнительные фильтры в таблицах
- Расширенная статистика

### v1.2.0
- Синхронизация проектов между устройствами
- Интеграция с GitHub для экспорта проектов
- Поддержка Podman в дополнение к Docker

### v2.0.0
- Веб-версия приложения
- API для других приложений
- Плагин система

---

## 11. Сроки и ресурсы

**Фаза 1: Архитектура и система настроек** (Week 1)
- Разработка базовой архитектуры
- Создание системы настроек
- Настройка инфраструктуры проекта

**Фаза 2: Основной функционал** (Weeks 2-4)
- Менеджер соединений
- Менеджер проектов
- Интеграция с Docker API

**Фаза 3: UI/UX и интеграция** (Weeks 5-6)
- Разработка интерфейсов
- Тестирование
- Оптимизация

**Фаза 4: Сборка и релиз** (Week 7)
- Сборка PyInstaller
- Тестирование на целевых ОС
- Подготовка к релизу

---

## 12. Метрики успеха

- ✅ Приложение компилируется без ошибок на Linux и macOS
- ✅ Все основные функции работают согласно ТЗ
- ✅ Время отклика UI < 500ms
- ✅ Нет критических ошибок при стандартном использовании
- ✅ Документация полная и актуальная
- ✅ Код покрыт unit тестами (минимум 60%)

